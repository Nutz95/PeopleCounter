fusion_strategy: RAW_STREAM_WITH_METADATA # ASYNC_OVERLAY

models:
  yolo_global:
    enabled: false  # disabled — using yolo_tiles only
    engine: models/tensorrt/yolo26x-seg-fp8-qdq.engine  # YOLOv8x FP8-QDQ — max accuracy global
  yolo_tiles:
    enabled: false
    engine: models/tensorrt/yolo26n-seg-fp8-qdq.engine  # YOLOv8n FP8-QDQ — fast tiling (batch 1..32)
  density:
    enabled: false
    engine: models/tensorrt/dm_count_qnrf_1920x1088_b1.engine
    # 4K → 1920×1088 global resize, single inference (batch=1, ~24 ms ✔️)
    # For full-resolution 2×2 tiling (~92 ms) swap to:
    #   engine: models/tensorrt/dm_count_qnrf_1920x1088.engine
    #   preprocess.density.mode: tiles
    strategy: sequential

trt_execution:
  enabled: true
  strict_shape_check: true

yolo_tiles_parallel:
  enabled: false  # disabled while yolo_tiles is off
  groups: 2

inference_streams:
  yolo: false
  density: false

density:
  tiling: 1

streams:
  transfer: 0
  yolo: 1
  yolo_global_preprocess: 3
  yolo_tiles_preprocess: 4
  density: 2
  density_preprocess: 5

preprocess_branches:
  yolo_global_preprocess: false  # disabled with yolo_global
  yolo_tiles_preprocess: false
  density_preprocess: false

tensor_pool:
  max_per_key: 64

preprocess:
  yolo_global:
    target_width: 640
    target_height: 640
    mode: global
    overlap: 0.0
  yolo_tiles:
    target_width: 640
    target_height: 640
    mode: tiles
    overlap: 0.2
  density:
    # 4K → 1920×1088 global resize (single frame, batch=1, ~24 ms)
    # Alternatives:
    #   mode: tiles, 1920×1088 → 2×2 tiling (~92 ms, native resolution per tile)
    #   mode: tiles, 640×720   → 6×3 tiling (~92 ms, rescaled tiles)
    # Both dims MUST be multiples of 16 (VGG16 feature-map stride).
    target_width: 1920
    target_height: 1088     # 68×16, nearest multiple of 16 ≥ 1080
    mode: global
    overlap: 0.0

# ── MJPEG video feed (Flask /api/video) ─────────────────────────────────────
# max_height: int or null (null = native camera resolution, e.g. 4K).
#   Reduce to 1080 / 720 to limit bandwidth on slower networks.
#   When set, aspect ratio is preserved (even pixel width guaranteed).
# quality: NVJPEG quality 1-100. Higher = larger JPEG, better image.
video_stream:
  max_height: null   # null = native 4K; set to 2160/1440/1080/720 as needed
  quality: 99
